const el=id=>document.getElementById(id),tBody=document.querySelector('#employeesTable tbody');let empPage=1,empTotalPages=1,empPerPage=10,empOrder=localStorage.getItem('order_employees')||'asc';const modal=el('modal'),form=el('employeeForm'),modalTitle=el('modalTitle');function showModal(edit=false,data={}){form.id.value=data.id||'';form.name.value=data.name||'';form.title.value=data.title||'';form.department.value=data.department||'';form.email.value=data.email||'';modalTitle.textContent=edit?'Edit Employee':'New Employee';modal.setAttribute('aria-hidden','false');modal.style.display='block'}function hideModal(){modal.setAttribute('aria-hidden','true');modal.style.display='none'}async function fetchEmployees(){const res=await fetch('/api/employees?page='+empPage+'&per_page='+empPerPage+'&order='+empOrder),body=await res.json(),list=body.data||body;empTotalPages=body.total_pages||1;const pageLabel=document.getElementById('pageLabel');pageLabel&&(pageLabel.textContent=`Page ${empPage} / ${empTotalPages}`);tBody.innerHTML='';for(const r of list){const tr=document.createElement('tr');tr.innerHTML=`<td>${r.id}</td><td>${escapeHtml(r.name)}</td><td>${escapeHtml(r.title||'')}</td><td>${escapeHtml(r.department||'')}</td><td>${escapeHtml(r.email||'')}</td><td><button data-id="${r.id}" class="edit">Edit</button><button data-id="${r.id}" class="del">Delete</button></td>`;tBody.appendChild(tr)}}function escapeHtml(s){return String(s).replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c]))}document.addEventListener('click',async ev=>{if(ev.target.matches('#createBtn'))showModal(false,{});else if(ev.target.matches('#cancelBtn'))hideModal();else if(ev.target.matches('button.edit')){const id=ev.target.getAttribute('data-id'),res=await fetch('/api/employees/'+id);res.ok&&(showModal(true,await res.json()))}else if(ev.target.matches('button.del')){if(!confirm('Delete employee?'))return;const id=ev.target.getAttribute('data-id'),res=await fetch('/api/employees/'+id,{method:'DELETE'});204===res.status?fetchEmployees():alert('Failed to delete')}});form.addEventListener('submit',async e=>{e.preventDefault();const data={name:form.name.value.trim(),title:form.title.value.trim(),email:form.email.value.trim(),department:form.department.value.trim()},id=form.id.value;if(id){const res=await fetch('/api/employees/'+id,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});res.ok?(hideModal(),fetchEmployees()):alert('Save failed')}else{const res=await fetch('/api/employees',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});201===res.status?(hideModal(),fetchEmployees()):alert('Create failed: '+(await res.json().catch(()=>({})).error||res.status))}});document.addEventListener('DOMContentLoaded',()=>{empPage=1;const orderBtn=document.getElementById('orderBtn');orderBtn&&(orderBtn.textContent='Order: '+('asc'===empOrder?'Asc':'Desc'),orderBtn.addEventListener('click',()=>{empOrder='asc'===empOrder?'desc':'asc';localStorage.setItem('order_employees',empOrder);orderBtn.textContent='Order: '+('asc'===empOrder?'Asc':'Desc');empPage=1;fetchEmployees()}));fetchEmployees();const prev=document.getElementById('prevBtn'),next=document.getElementById('nextBtn');prev&&prev.addEventListener('click',()=>{empPage>1&&(empPage--,fetchEmployees())});next&&next.addEventListener('click',()=>{empPage<empTotalPages&&(empPage++,fetchEmployees())})});
