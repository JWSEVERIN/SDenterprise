const els=id=>document.getElementById(id),tBodyS=document.querySelector('#servicesTable tbody');let svcPage=1,svcTotalPages=1,svcPerPage=10,svcOrder=localStorage.getItem('order_services')||'asc';const modalS=els('modal'),formS=els('serviceForm'),modalTitleS=els('modalTitle');function showModalS(edit=false,data={}){formS.id.value=data.id||'';formS.name.value=data.name||'';formS.category.value=data.category||'';formS.price.value=data.price||'';formS.description.value=data.description||'';modalTitleS.textContent=edit?'Edit Service':'New Service';modalS.setAttribute('aria-hidden','false');modalS.style.display='block'}function hideModalS(){modalS.setAttribute('aria-hidden','true');modalS.style.display='none'}async function fetchServices(){const res=await fetch('/api/services?page='+svcPage+'&per_page='+svcPerPage+'&order='+svcOrder),body=await res.json(),list=body.data||body;svcTotalPages=body.total_pages||1;const pageLabel=document.getElementById('pageLabel');pageLabel&&(pageLabel.textContent=`Page ${svcPage} / ${svcTotalPages}`);tBodyS.innerHTML='';for(const r of list){const tr=document.createElement('tr');tr.innerHTML=`<td>${r.id}</td><td>${escapeHtml(r.name)}</td><td>${escapeHtml(r.category||'')}</td><td>${r.price}</td><td>${escapeHtml(r.description||'')}</td><td><button data-id="${r.id}" class="edit">Edit</button><button data-id="${r.id}" class="del">Delete</button></td>`;tBodyS.appendChild(tr)}}function escapeHtml(s){return String(s).replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c]))}document.addEventListener('click',async ev=>{if(ev.target.matches('#createBtn'))showModalS(false,{});else if(ev.target.matches('#cancelBtn'))hideModalS();else if(ev.target.matches('button.edit')){const id=ev.target.getAttribute('data-id'),res=await fetch('/api/services/'+id);res.ok&&showModalS(true,await res.json())}else if(ev.target.matches('button.del')){if(!confirm('Delete service?'))return;const id=ev.target.getAttribute('data-id'),res=await fetch('/api/services/'+id,{method:'DELETE'});204===res.status?fetchServices():alert('Failed to delete')}});formS.addEventListener('submit',async e=>{e.preventDefault();const data={name:formS.name.value.trim(),category:formS.category.value.trim(),price:parseFloat(formS.price.value)||0,description:formS.description.value.trim()},id=formS.id.value;if(id){const res=await fetch('/api/services/'+id,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});res.ok?(hideModalS(),fetchServices()):alert('Save failed')}else{const res=await fetch('/api/services',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});201===res.status?(hideModalS(),fetchServices()):alert('Create failed: '+(await res.json().catch(()=>({})).error||res.status))}});document.addEventListener('DOMContentLoaded',()=>{const orderBtn=document.getElementById('orderBtn');orderBtn&&(orderBtn.textContent='Order: '+('asc'===svcOrder?'Asc':'Desc'),orderBtn.addEventListener('click',()=>{svcOrder='asc'===svcOrder?'desc':'asc';localStorage.setItem('order_services',svcOrder);orderBtn.textContent='Order: '+('asc'===svcOrder?'Asc':'Desc');svcPage=1;fetchServices()}));fetchServices();const prev=document.getElementById('prevBtn'),next=document.getElementById('nextBtn');prev&&prev.addEventListener('click',()=>{svcPage>1&&(svcPage--,fetchServices())});next&&next.addEventListener('click',()=>{svcPage<svcTotalPages&&(svcPage++,fetchServices())})});
